#!/bin/sh
# mistermaker: Automates building lots of PKGBUILDS
# Written by Renan Guilherme <japareaggae@gmail.com>

if [ -d "$2" ]; then
	DEVDIR="$2"
else
	DEVDIR="$(pwd)"
fi

# Finds directories and builds packages inside them
_build(){
for package in $DEVDIR/*/; do
	cd "$package"
	makepkg -sic
	cd ..
done
}

# Removes week-old packages or all packages
_clean(){
find $DEVDIR -iname "*.pkg.tar*" -mtime +7 -printf "%f\n" -delete
}

_purge(){
find $DEVDIR -iname "*.pkg.tar*" -printf "%f\n" -delete
}

case $1 in
	build) _build;;
	clean) _clean;;
	purge) _purge;;
	*) [ -d "$1" ] && DEVDIR="$1"
		_build ;;
esac
