#!/bin/sh
# Written by Renan Guilherme <japareaggae@gmail.com>
# Licensed under the public domain <http://unlicense.org/UNLICENSE>

_usage() {
cat << EOF
Usage: $(basename "$0") (screen) [mode] (filename)
Links an image to a default location, and sets it as the wallpaper using feh.

Screens:
  primary
  secondary

Modes (optional):
  fill (default)
  center
  tile
EOF
exit 1
}

# Check for realpath
if [ ! -x "$(which realpath)" ]; then
	echo "error: realpath is not installed"
	exit 1;
fi

# $1 -- Primary or secondary screen?
case $1 in
	primary)   DESTINATION="$HOME/.wallpaper0" ;;
	secondary) DESTINATION="$HOME/.wallpaper1" ;;
	*)         _usage ;;
esac

# $2 -- Set a background mode
case $2 in
	fill)   MODE="--bg-fill" ;;
	center) MODE="--bg-center" ;;
	tile)   MODE="--bg-tile" ;;

	# $2 can be a file too
	*) MODE="--bg-fill"
		if [ -e "$2" ]; then
			FILE="$2"
		else
			echo "error: $2 is not a valid file or mode"
			exit 1;
		fi
esac

# $3 -- If it exists, it is the file we want
[ "$3" ] && FILE="$3"

# Create a symbolic link
ln -sf "$(realpath "$FILE")" "$DESTINATION"

# Re-execute feh
# Note that feh does not allow setting different modes for each wallpaper.
feh $MODE "$HOME/.wallpaper0" "$HOME/.wallpaper1"

