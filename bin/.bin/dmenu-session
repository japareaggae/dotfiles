#!/bin/bash
# dmenu-session -- A session menu using systemd and dmenu
# Written by Renan Guilherme <japareaggae@gmail.com>
# Released under the public domain <http://unlicense.org/UNLICENSE>

_getOut(){
	( pgrep 'i3' > /dev/null )      && i3 exit
	( pgrep 'bspwm' > /dev/null )   && bspc quit
	( pgrep 'openbox' > /dev/null ) && openbox --exit
	( pgrep 'sway' > /dev/null )    && swaymsg exit
}

_lock(){
	if (pgrep 'xss-lock' > /dev/null); then
		# xss-lock works together with loginctl
		xset dpms force standby; loginctl lock-session
	elif (pgrep 'light-locker' > /dev/null); then
		light-locker-command -l
	elif [[ $SWAYSOCK ]]; then
		# sway has it's own locker
		$HOME/.bin/swaylocker
	else
		# i3lock is WM-agnostic enough to use as a catchall
		$HOME/.bin/i3locker
	fi
}

# Enable hibernation options on list only if there's a resume partition
grep 'resume=' /proc/cmdline && HIBERNATE_OPTIONS="hibernate\nhybrid-sleep\n"

if [[ "$1" ]]; then
	option=$1
else
	option=$( printf "cancel\nlock\nlogout\nshutdown\nreboot\nsuspend\n$HIBERNATE_OPTIONS" | dmenu -p Session )
fi

case $option in
	lock) _lock ;;
	logout) _getOut;;
	shutdown) systemctl poweroff;;
	reboot) systemctl reboot;;
	suspend) sleep 0.3s; systemctl suspend;;
	hibernate) sleep 0.3s; systemctl hibernate;;
	hybrid-sleep) sleep 0.3s; systemctl hybrid-sleep;;
	*) ;;
esac
