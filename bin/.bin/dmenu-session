#!/bin/bash
# dmenu-session -- A session menu using systemd and dmenu
# Written by Renan Guilherme <japareaggae@gmail.com>
# Released under the public domain <http://unlicense.org/UNLICENSE>

grep 'resume=' /proc/cmdline && HIBERNATE_OPTIONS="hibernate\nhybrid-sleep\n"

option=$( printf "cancel\nlock\nlogout\nshutdown\nreboot\nsuspend\n$HIBERNATE_OPTIONS" | dmenu -p Session )

_getOut(){
	(pgrep 'i3' > /dev/null) && i3 exit
	(pgrep 'bspwm' > /dev/null) && bspc quit
	(pgrep 'openbox' > /dev/null) && openbox --exit
	# For this to work, you need to add a file to /etc/sway/security.d
	# to add the "ipc" context to the "exit" command. Read the
	# 00-defaults file in that folder and the sway-security(7) manpage
	# for more information.
	(pgrep 'sway' > /dev/null) && swaymsg exit
}

_lock(){
	if (pgrep 'xss-lock' > /dev/null); then
		# xss-lock works together with loginctl
		xset dpms force standby; loginctl lock-session
	elif (pgrep 'light-locker' > /dev/null); then
		light-locker-command -l
	elif [[ $SWAYSOCK ]]; then
		# sway has it's own locker
		$HOME/.bin/swaylocker
	else
		# i3lock is WM-agnostic enough to use as a catchall
		$HOME/.bin/i3locker
	fi
}

case $option in
	lock) _lock ;;
	logout) _getOut;;
	shutdown) systemctl poweroff;;
	reboot) systemctl reboot;;
	suspend) sleep 0.3s; systemctl suspend;;
	hibernate) sleep 0.3s; systemctl hibernate;;
	hybrid-sleep) sleep 0.3s; systemctl hybrid-sleep;;
	*) ;;
esac
