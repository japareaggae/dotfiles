#!/bin/sh
# xdg-what-opens: Check which applications can open a file
# Written by Renan Guilherme <japareaggae@gmail.com>
# Released under the public domain <http://unlicense.org/UNLICENSE>

if ! [ $# -eq 1 ]; then
	echo "Usage: ${0##*/} file"
	exit 1
fi

if ! [ -e "$1" ]; then
	echo "Error: File does not exist"
	exit 1
fi

BOLD=$(tput bold)
RESET=$(tput sgr0)

FT=$(xdg-mime query filetype "$1")
DEF=$(xdg-mime query default $FT)  # This may be empty
DEF=${DEF%;}

echo "Recommended applications for filetype $FT:"
CANDIDATES=$(grep -rl "$FT" /usr/share/applications/*.desktop)

if [ $? -eq 1 ]; then
	echo "* No candidates found"
	exit
fi

for CAND in $CANDIDATES; do
SHORTCAND=$(printf $CAND | sed 's|/usr/share/applications/||')
	if [ "/usr/share/applications/$DEF" = $CAND ]; then
		#echo "* $SHORTCAND [default]"
		printf "${BOLD}* ${SHORTCAND} [default]${RESET}\n"
	else
		echo "* $SHORTCAND"
	fi
done
